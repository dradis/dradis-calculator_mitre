<% content_for :title, 'Edit MITRE' %>

<% content_for :sidebar do %>
  <%= render 'issues/sidebar' %>
<% end %>

<ol class="breadcrumb">
  <li class="breadcrumb-item">
    <%= link_to current_project.name, main_app.project_path(current_project) %>
  </li>
  <li class="breadcrumb-item">
    <%= link_to 'All issues', main_app.project_issues_path(current_project) %>
  </li>
  <li class="breadcrumb-item">
    <%= link_to @issue.title? ? @issue.title : "Issue ##{@issue.id}", main_app.project_issue_path(current_project, @issue) %>
  </li>
  <li class="breadcrumb-item active">
    MITRE ATT&CK
  </li>
</ol>

<div class="content-container">
  <h4 class="header-underline mb-2">Edit MITRE ATT&CK</h4>

  <!-- Tabs -->
  <ul class="nav nav-pills w-100" id="mitre-tabs">
    <li class="nav-item">
      <a href="#" class="nav-link active" data-domain="enterprise"><strong>Enterprise</strong></a>
    </li>
    <li class="nav-item">
      <a href="#" class="nav-link" data-domain="mobile"><strong>Mobile</strong></a>
    </li>
    <li class="nav-item">
      <a href="#" class="nav-link" data-domain="ics"><strong>ICS</strong></a>
    </li>
  </ul>

  <div id="issues_editor">
    <div class="inner note-text-inner">
      <%= simple_form_for [:mitre, current_project, @issue], method: :patch do |f| %>
        <div class="mitre-calculator">

          <div class="mitre-columns d-flex w-100">
            <!-- Left Column -->
            <div class="left-column">

              <!-- Row: Tactic -->
              <div class="form-row">
                <div class="form-label">Tactic:</div>
                <div class="form-input">
                  <select id="tactic-select" class="form-select"></select>
                </div>
                <div class="form-action">
                  <button type="button" class="btn btn-primary add-button" data-type="tactic">Add</button>
                </div>
              </div>

              <!-- Row: Technique -->
              <div class="form-row">
                <div class="form-label">Technique:</div>
                <div class="form-input">
                  <select id="technique-select" class="form-select"></select>
                </div>
                <div class="form-action">
                  <button type="button" class="btn btn-primary add-button" data-type="technique">Add</button>
                </div>
              </div>

              <!-- Row: Sub-Technique -->
              <div class="form-row">
                <div class="form-label">Sub-Technique:</div>
                <div class="form-input">
                  <select id="subtechnique-select" class="form-select"></select>
                </div>
                <div class="form-action">
                  <button type="button" class="btn btn-primary add-button" data-type="subtechnique">Add</button>
                </div>
              </div>

              <hr class="my-1">

              <!-- Row: Style + Clear -->
              <div class="form-row">
                <div class="form-label">Style:</div>
                <div class="form-input">
                  <div class="form-check">
                    <%= radio_button_tag :style, 'inline', true, class: 'form-check-input', id: 'style_inline' %>
                    <label class="form-check-label" for="style_inline">Inline</label>
                  </div>
                  <div class="form-check">
                    <%= radio_button_tag :style, 'list', false, class: 'form-check-input', id: 'style_list' %>
                    <label class="form-check-label" for="style_list">List</label>
                  </div>
                </div>
                <div class="form-action">
                  <button type="button" class="btn btn-primary clear-button">Clear</button>
                </div>
              </div>

              <!-- Row: Submit / Cancel -->
              <div class="form-actions mt-2">
                <%= f.button :submit, nil, class: 'btn btn-primary' %> or
                <%= link_to 'Cancel', main_app.project_issue_path(current_project, @issue), class: 'cancel-link' %>
              </div>

            </div> <!-- /left-column -->

            <!-- Right Column -->
            <div class="right-column">
              <div class="form-row">
                <%= text_area_tag :mitre_fields, @issue_fields, id: 'mitre-output', class: 'form-control' %>
              </div>
            </div>

          </div> <!-- /d-flex -->

        </div> <!-- /mitre-calculator -->
      <% end %>
    </div>
  </div>
</div>
